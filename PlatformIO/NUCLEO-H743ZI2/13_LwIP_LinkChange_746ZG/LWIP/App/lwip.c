/*
# ##############################################################################
# File: lwip.c                                                                 #
# Project: App                                                                 #
# Created Date: Tuesday, September 26th 2023, 2:47:48 am                       #
# Author: Zafeer Abbasi                                                        #
# ----------------------------------------------                               #
# Last Modified: Tuesday, October 10th 2023, 1:05:08 am                        #
# Modified By: Zafeer Abbasi                                                   #
# ----------------------------------------------                               #
# Copyright (c) 2023 Zafeer.A                                                  #
# ----------------------------------------------                               #
# HISTORY:                                                                     #
 */

/*##############################################################################################################################################*/
/*INCLUDES______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

#include "lwip.h"

/*##############################################################################################################################################*/
/*FUNCTION DECLARATIONS_________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*GLOBALS_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

struct netif gNetif;

ip4_addr_t IPAddr;
ip4_addr_t netMask;
ip4_addr_t gateWay;

uint8_t IP_ADDRESS[ 4 ];
uint8_t NETMASK_ADDRESS[ 4 ];
uint8_t GATEWAY_ADDRESS[ 4 ];


/*##############################################################################################################################################*/
/*DEFINES_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*EXTERNS_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*TYPEDEFS/STRUCTS/ENUMS________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*FUNCTIONS_____________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

/**
 * @brief LwIP Init 
 * 
 */
void LWIP_libInit( void )
{
    /*Set IP Address :  192.168.000.222*/
    IP_ADDRESS[0] =  192;
    IP_ADDRESS[1] =  168;
    IP_ADDRESS[2] =  0;
    IP_ADDRESS[3] =  222;

    /*Set Netmask Address :  255.255.255.000*/
    NETMASK_ADDRESS[0]	= 255;
    NETMASK_ADDRESS[1]	= 255;
    NETMASK_ADDRESS[2]	= 255;
    NETMASK_ADDRESS[3]	= 0;

    /*Set Gatway Address :  000.000.000.000*/
    GATEWAY_ADDRESS[0] = 0;
    GATEWAY_ADDRESS[1] = 0;
    GATEWAY_ADDRESS[2] = 0;
    GATEWAY_ADDRESS[3] = 0;

    /*Initialize LwIP stack Without RTOS*/
    lwip_init( );

    /*Initialize IP Address*/
    IP4_ADDR( &IPAddr, IP_ADDRESS[ 0 ], IP_ADDRESS[ 1 ], IP_ADDRESS[ 2 ], IP_ADDRESS[ 3 ] );

    /*Initialize netmask address*/
    IP4_ADDR( &netMask, NETMASK_ADDRESS[ 0 ], NETMASK_ADDRESS[ 1 ], NETMASK_ADDRESS[ 2 ], NETMASK_ADDRESS[ 3 ] );

    /*Initialize gateway address*/
    IP4_ADDR( &gateWay, GATEWAY_ADDRESS[ 0 ], GATEWAY_ADDRESS[ 1 ], GATEWAY_ADDRESS[ 2 ], GATEWAY_ADDRESS[ 3 ] );

    /*Add network interface Without RTOS*/
    netif_add( &gNetif, &IPAddr, &netMask, &gateWay, NULL, &ETH_EthernetIFInit, &ethernet_input );

    /*Set default Netif*/
    netif_set_default( &gNetif );

    /*Check if link is up*/
    if( netif_is_link_up( &gNetif ) )
    {
        netif_set_up( &gNetif );
    }
    else
    {
        netif_set_down( &gNetif );
    }

    /*Set link change callback*/
    netif_set_link_callback( &gNetif, ETH_EthernetIFUpdateConfig );
}

/**
 * @brief LwIP Process
 * 
 */
void LWIP_process( void )
{
    ETH_EthernetIFInput( &gNetif );
    sys_check_timeouts( );
}